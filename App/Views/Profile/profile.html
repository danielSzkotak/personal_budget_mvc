{% extends "baseAfterLogin.html" %}

{% block title %}Profil{% endblock %}

{% block body %}

{% block footer %}




<!-- main secion -->
<section id="main">
    <div class="container-xxl mt-5">
       <div class="row align-items-start">
          <div class="col-lg-6 align-self-start dupa">
             <header>

               {% if currentUser %}
                  <span><h1 class='text-start'>Witaj <span class='text-success'>{{currentUser.username}}</h1></span>
               {% endif %} 

             </header>
             <div class="row">
                <a href="/addIncome" class="col bg-light mb-2 me-2 p-5 rounded-3 text-center text-white text-nowrap fs-2">
                   Dodaj przychód
                </a>
                <a href="/addExpense" class="col bg-secondary mb-2 me-2 p-5 rounded-3 text-center text-white text-nowrap fs-2">
                   Dodaj rozchód
                </a>
             </div>
             <div class="row">
                <a href="/period" class="col bg-info me-2 p-5 rounded-3 text-center text-nowrap text-white fs-2">
                   Przeglądaj bilans
                </a>
             </div>
          </div>
          <div class="col ms-lg-5 mt-5 mt-lg-0">
             <header>
                <h1 class="text-start">Edycja kategorii</h1>
             </header>

             <!-- <form action="/income/add" method="POST" class="needs-validation" id="addIncomeForm" novalidate> -->
                
                <div class="mb-3">
                   <label for="selectIncomeCategory" class="form-label">Wybierz kategorię przychodu do edycji</label>
                   <select name="incomeCategory"  class="form-select fs-5 pt-3 pb-3" id="selectedIncomeCategory" aria-label="Default select example">

                      {% if income_cat %} 
                        {% for key, value in income_cat %}
                           <option value="{{ value.id|e }}|{{ value.name|e }}">{{ value.name|e }}</option>
                        {% endfor %}
                      {% endif %}                      

                   </select>
                </div>
                
                <td><button type="button" class="btn btn-light p-4 categoryEdit" data-id="dupencjka">Zmień nazwę</button></td>

                <!-- Modal -->
               <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                     <div class="modal-content">
                        <div class="modal-header">
                           <h5 class="modal-title" id="exampleModalLabel">Zmiana nazwy kategorii</h5>
                           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                           <h4></h4>

                           <form action="/profile/editCategoryName" method="POST" class="needs-validation" id="editCategoryForm" novalidate>
                           <input type="text" class="form-control fs-5 pt-3 pb-3 shadow-none mb-2" name="categoryName" id="categoryName" value="" autofocus>
                           <input type="hidden" name="categoryID" id="categoryID">
                           
                        </div>
                        <div class="modal-footer">
                           <button type="submit" name="submitCategory" value="submitCategory" 
                              class="btn btn-success" data-bs-toggle="modal">Zapisz</button>
                        </div>
                     </form>

                     </div>
                  </div>
               </div>
               <!-- End of Modal -->
                
     


          </div>
       </div>
    </div>
 </section>
<!-- end of main section -->

<script>

$(document).ready(function(){

         $(".categoryEdit").click(function(){

            
            var selectedIncomeCategory = $("#selectedIncomeCategory").val();
            
            $("select.form-select").change(function(){
               selectedIncomeCategory = $(this).children("option:selected").val();
            });

            var categoryName = selectedIncomeCategory.split("|");
            
            $('#categoryName').val( categoryName[1] );
            $('#categoryID').val( categoryName[0] );
            
            $('#myModal').modal('show');
           
            $('#myModal').on('shown.bs.modal', function() {
               $('#categoryName').focus();
            });

         });
});


    //Jquery Validation
$.validator.setDefaults({
  errorClass: 'invalid-feedback',
  highlight: function(element){
      $(element)
          .addClass('is-invalid');
  },
  unhighlight: function(element){
      $(element)
          .removeClass('is-invalid')
          .addClass('is-valid')
  },
});

$.validator.addMethod('validDates',
  function(value, element, param){
      if (value != '') {
          if (value < '2000-01-01') {
              return false;
          }
      }
      return true;
  },
  'Data musi być większa od 01-01-2000'

);


$(document).ready(function(){
  $('#addIncomeForm').validate({
      rules: {
         incomeAmount: { 
          required: true 
          },
         incomeDate: {
            required: true,
            validDates: true
         }                     
      },
      messages: {
         incomeAmount: {
              required: '<span class="text-danger">To pole jest wymagane</span>'
          },
          incomeDate: {
            required: '<span class="text-danger">To pole jest wymagane</span>'
          }   
      }
  });           
});

//---end---
</script>

{% endblock %}
{% endblock %}

